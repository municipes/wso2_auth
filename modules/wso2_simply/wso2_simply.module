<?php

/**
 * @file
 * Modulo WSO2 Simply per autenticazione OAuth2.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function wso2_simply_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    case 'help.page.wso2_simply':
      return '<p>' . t('Questo modulo gestisce l\'autenticazione OAuth2 tramite WSO2 con redirect automatico.') . '</p>';
  }
}

/**
 * Implements hook_page_attachments().
 */
function wso2_simply_page_attachments(array &$attachments) {
  // Ottieni le configurazioni del modulo
  $config = \Drupal::config('wso2_simply.settings');

  // Controlla se il modulo Ã¨ abilitato
  if (!$config->get('enabled')) {
    return;
  }

  // Aggiungi il JS a tutte le pagine
  $attachments['#attached']['library'][] = 'wso2_simply/wso2_simply';

  // Passa le configurazioni al JavaScript
  $attachments['#attached']['drupalSettings']['wso2_simply'] = [
    'oauth_url' => $config->get('oauth_url'),
    'client_id' => $config->get('client_id'),
    'redirect_uri' => $config->get('redirect_uri'),
    'scope' => $config->get('scope'),
    'base_redirect_url' => $config->get('base_redirect_url'),
  ];
}
